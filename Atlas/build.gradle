apply plugin: 'java'
apply from: 'gradleScripts/util.gradle'

sourceCompatibility = 1.7
version = '0.2.2-alpha'

setupDefaultDirectoryStructure()

setupDefaultRepositories()

setupProjectSpecificDependencies()

apply plugin: 'application'

applicationName = "IHMCAtlasAPI"
mainClassName = "us.ihmc.atlas.AtlasROSAPINetworkProcessor"
applicationDefaultJvmArgs = ["-Xmx1024m"]

startScripts {
    outputs.upToDateWhen { false }

    doLast {
        def simUnixScript = file(outputDir.canonicalPath + "/${applicationName}Simulator")
        simUnixScript.text = unixScript.text.replace("IHMCAtlasAPI", "IHMCAtlasAPISimulator").replace("AtlasROSAPINetworkProcessor", "AtlasROSAPISimulator")
        simUnixScript.setExecutable(true)

        def simWindowsScript = file(outputDir.canonicalPath + "/${applicationName}Simulator.bat")
        simWindowsScript.text = windowsScript.text.replace("IHMCAtlasAPI", "IHMCAtlasAPISimulator").replace("AtlasROSAPINetworkProcessor", "AtlasROSAPISimulator")
    }
}

applicationDistribution.from(startScripts.outputDir) {
    into "bin"
}

applicationDistribution.from(file("IHMCNetworkParameters.ini")) {
	into "bin"
}

task pushBuild(type:Exec, dependsOn:distTar) {
    doLast {
        def userName = "${bitbucket_user}"
        def password = "${bitbucket_password}"
        def repoUrl = "/ihmcrobotics/ihmc_msgs/downloads"
        def targetFile = "build/distributions/${applicationName}-${version}.tar"
    
        commandLine 'build_utilities/upload-to-bitbucket.sh', userName, password, repoUrl, targetFile
    }
}
