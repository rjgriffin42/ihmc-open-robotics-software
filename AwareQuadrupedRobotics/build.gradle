apply plugin: 'java'
apply from: 'gradleScripts/util.gradle'

sourceCompatibility = 1.7
version = '1.0'

setupDefaultDirectoryStructure()

setupDefaultRepositories()

setupProjectSpecificDependencies()

jar {
	List depend = []
	configurations.runtime.each {
			depend.add('lib/' + it.name)
	}

   manifest {
      attributes(
      "Created-By": "IHMC Gradle Build Script",
      "Implementation-Title": project.name,
      "Implementation-Version": project.version,
      "Implementation-Vendor": "IHMC",
      
      "Bundle-Name": project.name,
      "Bundle-Version": project.version,
      "Bundle-License": "IHMC Proprietary",
      "Bundle-Vendor": "IHMC",
      'Class-Path': depend.join(' '))
   }
}


buildscript {
  repositories {
	  jcenter()

  }  
  dependencies {
      classpath 'org.hidetake:gradle-ssh-plugin:0.3.12'
  }
}

apply plugin: 'org.hidetake.ssh'

remotes 
{
	actuatorRealtimeComputer
	{
		host = '10.7.4.160'
		
		// Set the username and password in ~/.gradle/gradle.properties.
        user = project.hasProperty('***REMOVED***_realtime_username')?"${***REMOVED***_realtime_username}":"invalid"
        password = project.hasProperty('***REMOVED***_realtime_password')?"${***REMOVED***_realtime_password}":"invalid"
        
		knownHosts = allowAnyHosts
	}
}


task deploy(dependsOn: ['jar']) {
	
	def projectDir = project.buildscript.sourceFile.parent 
	def directory = '***REMOVED***'

	doLast {
    	if(!project.hasProperty('***REMOVED***_realtime_username') || !project.hasProperty('***REMOVED***_realtime_password'))
    	{
    		throw new GradleException("Please set ***REMOVED***_realtime_username and ***REMOVED***_realtime_password in ~/.gradle/gradle.properties. See https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_properties_and_system_properties for more information.")
    	}
    	if(!project.hasProperty('***REMOVED***_nonrealtime_username') || !project.hasProperty('***REMOVED***_nonrealtime_password'))
    	{
    		throw new GradleException("Please set ***REMOVED***_nonrealtime_username and ***REMOVED***_nonrealtime_password in ~/.gradle/gradle.properties. See https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_properties_and_system_properties for more information.")
    	}
	
		sshexec {
			session(remotes.actuatorRealtimeComputer)
			{
				execute("mkdir -p " + directory + "/lib")
				
				configurations.runtime.each 
				{
					put it, directory + '/lib'
				}
				
				put jar.archivePath, directory + '/***REMOVED***Controller.jar'
				
				def scriptDir = new File(projectDir, "launchScripts/realtime")
				def scriptDirCollection = files { scriptDir.listFiles() }
				put scriptDirCollection, directory
				
				scriptDirCollection.each
				{
					execute 'chmod 777 ' + directory + '/' + it.name
				}			
				
			}
			
		}
		
		
	}
}
