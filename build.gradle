apply plugin: 'java'
apply from: 'gradleScripts/util.gradle'

sourceCompatibility = 1.7
version = '1.0'

setupDefaultDirectoryStructure()

setupDefaultRepositories()

setupProjectSpecificDependencies()

buildscript {
  repositories {
	  maven{
		  url "https://bengal.ihmc.us/nexus/content/repositories/central/"
	  }
  }  
  dependencies {
      classpath 'org.hidetake:gradle-ssh-plugin:0.3.12'
  }
}

apply plugin: 'org.hidetake.ssh'

remotes 
{
	valkyrieRealtimeComputer
	{
		host = '139.169.44.45'
		user = 'root'
		password = 'unknownpw'
		knownHosts = allowAnyHosts
	}
}

jar {
	List depend = []
	configurations.runtime.each {
		if(!it.name.contains("IHMCHumanoidOperatorInterface"))
		{
			depend.add('lib/' + it.name)
		}
	}
	manifest {		
		attributes('Created-By': 'IHMC Gradle Build Script', 'Implementation-Vendor': 'IHMC', 'Class-Path': depend.join(' '))
	}
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.1'
}

task deploy(dependsOn: assemble) {
	
	def directory = 'valkyrie'

	doLast {
		sshexec {
			session(remotes.valkyrieRealtimeComputer)
			{
				execute("mkdir -p " + directory + "/lib")
				execute("mkdir -p " + directory + "/Configurations")
				
				configurations.runtime.each 
				{
					if(!it.name.contains("IHMCHumanoidOperatorInterface"))
					{
						put it, directory + '/lib'
					}
				}
				
				put jar.archivePath, directory + '/ValkyrieController.jar'
				
				def scriptDir = new File("launchScripts/")
				def scriptDirCollection = files { scriptDir.listFiles() }
				put scriptDirCollection, directory
				
				scriptDirCollection.each
				{
					execute 'chmod 777 ' + directory + '/' + it.name
				}
				
				put "Configurations/valkyrie_network_config.ini", directory + "/Configurations"
				
				
			}
			
		}
	}
}